<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/sot/assets/css/style.css?v=10ade4696ae595687924e6028f819ba11c064777">
    <link rel="stylesheet" type="text/css" href="/sot/assets/css/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<!-- Begin Jekyll SEO tag v2.3.0 -->
<title> | Simple Observer Timer</title>
<meta property="og:title" content="Simple Observer Timer" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="SOT is the acronym of “simple observer timer”, it takes as parameters a number of minutes upon which an alarm will sound, and maybe an URL of a link to display in a new browser tab (e.g., the observer form)." />
<meta property="og:description" content="SOT is the acronym of “simple observer timer”, it takes as parameters a number of minutes upon which an alarm will sound, and maybe an URL of a link to display in a new browser tab (e.g., the observer form)." />
<link rel="canonical" href="https://lprisan.github.io/sot/" />
<meta property="og:url" content="https://lprisan.github.io/sot/" />
<meta property="og:site_name" content="sot" />
<script type="application/ld+json">
{"name":"sot","description":"SOT is the acronym of “simple observer timer”, it takes as parameters a number of minutes upon which an alarm will sound, and maybe an URL of a link to display in a new browser tab (e.g., the observer form).","author":null,"@type":"WebSite","url":"https://lprisan.github.io/sot/","image":null,"publisher":null,"headline":"Simple Observer Timer","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h2>Simple Observer Timer</h2>
          <button id="button"  style="font-size : 30px;">Click to start</button>
          <h1 id="message"><span id="timeleft"></span> left for alarm...</h1>
        </header>
        <hr>
        <section id="main_content">
<h4>You can also go to the <a id="link" href="http://tinyurl.com/linnaruum-observer" target="_new">observer form</a> (opens a new browser tab).</h4>

        </section>

        <footer>

          SOT is maintained by <a href="https://github.com/lprisan">lprisan</a><br>

          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </footer>

      </div>
    </div>

<script type="text/javascript">

var audioElements = document.getElementsByTagName('audio'),
    sounds = {};


function mediaPlaybackRequiresUserGesture() {
    // test if play() is ignored when not called from an input event handler
    var video = document.createElement('video');
    video.play();
    return video.paused;
}

function removeBehaviorsRestrictions() {
    for (var i = 0; i < audioElements.length; i++) {
        audioElements[i].load();
    }

    window.removeEventListener('keydown', removeBehaviorsRestrictions);
    window.removeEventListener('mousedown', removeBehaviorsRestrictions);
    window.removeEventListener('touchstart', removeBehaviorsRestrictions);
}

function playSound(sound) {
    for (var key in sounds) {
      sounds[key].pause();
    }

    sounds[sound].load();
    sounds[sound].play();
}

function setupTimer(duration, display, linkurl){
    var timer = duration, minutes, seconds;
    var link = document.getElementById('link');
    link.href = linkurl;

        minutes = parseInt(timer / 60, 10)
        seconds = parseInt(timer % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = minutes + ":" + seconds;

        var pretitle = document.title.substring(document.title.indexOf(" | "));
        //update also the title
        document.title = minutes + ":" + seconds + " " + pretitle;

}

function startTimer(duration, display, linkurl) {
    var timer = duration, minutes, seconds;
    var link = document.getElementById('link');
    link.href = linkurl;

    setInterval(function () {
        minutes = parseInt(timer / 60, 10)
        seconds = parseInt(timer % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = minutes + ":" + seconds;

        var pretitle = document.title.substring(document.title.indexOf(" | "));
        //update also the title
        document.title = minutes + ":" + seconds + " " + pretitle;

        if (--timer < 0) {
            timer = duration;
            //document.getElementById('alarm').play();
            playSound('alarm');
        }
    }, 1000);
}

function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}

var url="http://tinyurl.com/linnaruum-observer";

function isURL(str) {
  var pattern = new RegExp('^(https?:\\/\\/)?'+ // protocol
  '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}|'+ // domain name
  '((\\d{1,3}\\.){3}\\d{1,3}))'+ // OR ip (v4) address
  '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+ // port and path
  '(\\?[;&a-z\\d%_.~+=-]*)?'+ // query string
  '(\\#[-a-z\\d_]*)?$','i'); // fragment locator
  return pattern.test(str);
}

window.onload = function () {

//Potential fix?
for (var i = 0; i < audioElements.length; i++) {
    sounds[audioElements[i].className] = audioElements[i];
}
// Solves chrome for andriod issue 178297 Require user gesture
// https://code.google.com/p/chromium/issues/detail?id=178297
// Fix based on code from http://blog.foolip.org/2014/02/10/media-playback-restrictions-in-blink/
if (mediaPlaybackRequiresUserGesture()) {
    window.addEventListener('keydown', removeBehaviorsRestrictions);
    window.addEventListener('mousedown', removeBehaviorsRestrictions);
    window.addEventListener('touchstart', removeBehaviorsRestrictions);
}
///////////////


    var fiveMinutes = 60 * 5,
    display = document.querySelector('#timeleft');

    if(parseInt(getParameterByName('time'))>0){
        fiveMinutes = parseInt(getParameterByName('time'))*60;
    }

    if(getParameterByName('url')!=null && isURL(decodeURIComponent(getParameterByName('url')))){
        url = decodeURIComponent(getParameterByName('url'));
    }

    setupTimer(fiveMinutes, display, url);
    document.getElementById('button').onclick=function(){document.getElementById('alarm').play();startTimer(fiveMinutes, display, url);document.getElementById('button').disabled=true;}

};
</script>

<audio preload='preload' id='alarm' class='alarm'>
        <source src='media/alarm.ogg' type='audio/ogg' />
        <source src='media/alarm.mp3' type='audio/mpeg' />
        <source src='media/alarm.wav' type='audio/wav' />
</audio>

  </body>
</html>
